<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>å®¶äº‹ã®ã€Œã„ã¤ã ã£ã‘ï¼Ÿã€è§£æ±ºãã‚“</title>
    <style>
        :root {
            /* Default: ãµã‚“ã‚ã‚Š (Soft) */
            --primary-bg: #fffbf5;
            --card-bg: #ffffff;
            --accent-color: #ff9a9e;
            --secondary-accent: #fad0c4;
            --text-main: #5d5d5d;
            --text-light: #8e8e8e;
            --shadow: 0 4px 15px rgba(255, 154, 158, 0.1);
            --radius: 20px;
            --nav-bg: #f0e6dd;
            --slider-bg: #fdfaf7;
        }

        [data-theme="calm"] {
            --primary-bg: #1a1c1e;
            --card-bg: #2d2f31;
            --accent-color: #ffb4b9;
            --secondary-accent: #4a4d51;
            --text-main: #f1f1f1;
            --text-light: #a0a0a0;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            --nav-bg: #111111;
            --slider-bg: #1a1c1e;
        }

        [data-theme="natural"] {
            --primary-bg: #eef2e7;
            /* More muted, sage-beige green */
            --card-bg: #ffffff;
            --accent-color: #7ba644;
            /* Slightly deeper green for better contrast */
            --secondary-accent: #d3dbca;
            --text-main: #3e4a32;
            --text-light: #6c7a5f;
            --shadow: 0 4px 15px rgba(62, 74, 50, 0.08);
            --nav-bg: #dae2d0;
            --slider-bg: #f5f7f1;
        }

        * {
            box-sizing: border-box;
            appearance: none;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 500px;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .icon-btn {
            background: var(--card-bg);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s;
            border: none;
        }

        .icon-btn:active {
            transform: scale(0.9);
        }

        .icon-btn.active {
            border: 2px solid var(--accent-color);
        }

        .nav-tabs {
            display: flex;
            background: var(--nav-bg);
            padding: 5px;
            border-radius: 25px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto 25px;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-light);
        }

        .nav-tab.active {
            background: var(--card-bg);
            color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .container {
            width: 100%;
            max-width: 500px;
            padding-bottom: 100px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
        }

        .category-label {
            font-size: 0.65rem;
            color: var(--accent-color);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
            display: block;
        }

        .task-name {
            font-weight: bold;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 6px;
        }

        .task-meta {
            font-size: 0.8rem;
            color: var(--text-light);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .status-due {
            background: #ffebeb;
            color: #ff6b6b;
        }

        .status-ok {
            background: #e8fbf0;
            color: #2ecc71;
        }

        .status-future {
            background: #f0f0f0;
            color: #888;
        }

        .advice-box {
            font-size: 0.75rem;
            color: var(--text-light);
            font-style: italic;
            margin-top: 10px;
            padding-left: 10px;
            border-left: 3px solid var(--secondary-accent);
        }

        .slider-section {
            margin: 15px 0;
            background: var(--slider-bg);
            padding: 12px;
            border-radius: 15px;
        }

        .slider-label {
            font-size: 0.75rem;
            color: var(--text-light);
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider-value {
            color: var(--accent-color);
            font-weight: bold;
        }

        .guide-text {
            font-size: 0.65rem;
            color: var(--text-light);
            opacity: 0.7;
            margin-top: 4px;
            display: block;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 5px;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--accent-color);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 18px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-complete {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 154, 158, 0.2);
        }

        .btn-tomorrow {
            background: #eee;
            color: #888;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .form-group {
            text-align: left;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--text-main);
            background: var(--card-bg);
        }

        .form-inline {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--accent-color);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 20px rgba(255, 154, 158, 0.4);
            font-size: 2rem;
            cursor: pointer;
            z-index: 100;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
    </style>
</head>

<body>
    <header>
        <h1>å®¶äº‹ã®ã€Œã„ã¤ã ã£ã‘ï¼Ÿã€è§£æ±ºãã‚“</h1>
        <p class="subtitle" id="dynamic-subtitle">å¿˜ã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ã€ã‚ãªãŸã¯æ¯æ—¥é ‘å¼µã£ã¦ã„ã¾ã™ã€‚ âœ¨</p>
        <div class="controls">
            <button class="icon-btn" onclick="setTheme('soft')" id="theme-soft" title="ãµã‚“ã‚ã‚Š">â˜€ï¸</button>
            <button class="icon-btn" onclick="setTheme('calm')" id="theme-calm" title="è½ã¡ç€ã">ğŸŒ™</button>
            <button class="icon-btn" onclick="setTheme('natural')" id="theme-natural" title="ãƒŠãƒãƒ¥ãƒ©ãƒ«">ğŸŒ¿</button>
            <button class="icon-btn" onclick="toggleNotifications()" id="notif-btn" title="é€šçŸ¥è¨­å®š">ğŸ””</button>
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" id="tab-today" onclick="switchView('today')">ã‚„ã‚‹ã“ã¨</div>
            <div class="nav-tab" id="tab-dashboard" onclick="switchView('dashboard')">è¨­å®šä¸€è¦§</div>
        </div>
    </header>

    <div class="container">
        <div id="view-today" class="view active">
            <div id="today-list" class="task-list"></div>
        </div>
        <div id="view-dashboard" class="view">
            <div id="dashboard-list" class="task-list"></div>
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn-tomorrow" style="width: auto; padding: 12px 24px; font-size: 0.8rem; opacity: 0.7;"
                    onclick="resetTasks()">åˆæœŸè¨­å®šï¼ˆ20é …ç›®ï¼‰ã«æˆ»ã™</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="feedback-overlay" class="modal-overlay" onclick="closeModal('feedback-overlay')">
        <div class="modal-content slide-up" onclick="event.stopPropagation()">
            <p id="praise-text"
                style="font-size: 1.4rem; color: var(--accent-color); font-weight: bold; margin-bottom: 10px;"></p>
            <p style="margin-bottom: 25px;">ã“ã‚Œã§ã¾ãŸå®¶æ—ãŒå¿«é©ã«éã”ã›ã¾ã™ã­ â˜ºï¸</p>
            <button class="btn-complete" onclick="closeModal('feedback-overlay')">ã‚ã‚ŠãŒã¨ã†ï¼</button>
        </div>
    </div>

    <div id="add-modal" class="modal-overlay">
        <div class="modal-content slide-up">
            <h2 style="color: var(--accent-color); margin-top: 0;">æ–°ã—ã„å®¶äº‹ã‚’è¿½åŠ </h2>
            <div class="form-group">
                <label>å®¶äº‹ã®åå‰</label>
                <input type="text" id="new-task-name" placeholder="ä¾‹ï¼šãƒˆã‚¤ãƒ¬ã®å±¤æ´—æµ„">
            </div>
            <div class="form-group">
                <label>ç¹°ã‚Šè¿”ã™å‘¨æœŸ</label>
                <div class="form-inline">
                    <input type="number" id="new-task-value" value="1" min="1" max="99" style="flex:1;">
                    <select id="new-task-unit" style="flex:1.5;">
                        <option value="days">æ—¥ãŠã</option>
                        <option value="weeks" selected>é€±é–“ãŠã</option>
                        <option value="months">ãƒ¶æœˆãŠã</option>
                        <option value="years">å¹´ãŠã</option>
                    </select>
                </div>
                <span class="guide-text" id="add-guide"></span>
            </div>
            <button class="btn-complete" onclick="addTask()">ä¿å­˜ã™ã‚‹</button>
            <button class="btn-tomorrow" style="margin-top:10px;" onclick="closeModal('add-modal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div class="fab" id="fab-plus" onclick="showModal('add-modal')">+</div>

    <script>
        const STANDARD_GUIDES = {
            'æµ„æ°´å™¨': { val: 4, unit: 'months', text: '4ãƒ¶æœˆ' },
            'è£½æ°·æ©Ÿ': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'é£Ÿæ´—æ©Ÿ': { val: 1, unit: 'weeks', text: '1é€±é–“' },
            'æ›æ°—æ‰‡': { val: 2, unit: 'months', text: '2ãƒ¶æœˆ' },
            'å†·è”µåº«': { val: 6, unit: 'months', text: '6ãƒ¶æœˆ' },
            'é˜²ã‚«ãƒ“': { val: 2, unit: 'months', text: '2ãƒ¶æœˆ' },
            'æ’æ°´æº': { val: 1, unit: 'weeks', text: '1é€±é–“' },
            'æ´—æ¿¯æ§½': { val: 2, unit: 'months', text: '2ãƒ¶æœˆ' },
            'é€šæ°—å£': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'ãƒˆã‚¤ãƒ¬': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'ã‚¨ã‚¢ã‚³ãƒ³': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'ç©ºæ°—æ¸…æµ„æ©Ÿ': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'åŠ æ¹¿å™¨': { val: 2, unit: 'weeks', text: '2é€±é–“' },
            'æƒé™¤æ©Ÿ': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'ã‚«ãƒ¼ãƒ†ãƒ³': { val: 6, unit: 'months', text: '6ãƒ¶æœˆ' },
            'ã‚ªã‚¤ãƒ«': { val: 6, unit: 'months', text: '6ãƒ¶æœˆ' },
            'æ´—è»Š': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'è‡ªè»¢è»Š': { val: 1, unit: 'months', text: '1ãƒ¶æœˆ' },
            'ç«ç½å ±çŸ¥å™¨': { val: 1, unit: 'years', text: '1å¹´' },
            'é˜²ç½': { val: 1, unit: 'years', text: '1å¹´' }
        };

        const INITIAL_PRESETS = [
            { id: 101, name: 'æµ„æ°´å™¨ã‚«ãƒ¼ãƒˆãƒªãƒƒã‚¸äº¤æ›', category: 'ã‚­ãƒƒãƒãƒ³', val: 4, unit: 'months', advice: 'ç¾å‘³ã—ã„ãŠæ°´ã®ãŸã‚ã«', order: 1 },
            { id: 102, name: 'è£½æ°·æ©Ÿã®çµ¦æ°´ã‚¿ãƒ³ã‚¯æƒé™¤', category: 'ã‚­ãƒƒãƒãƒ³', val: 1, unit: 'months', advice: 'ãŠæ°·ã‚‚æ¸…æ½”ãŒä¸€ç•ªã§ã™ã­', order: 2 },
            { id: 103, name: 'é£Ÿæ´—æ©Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'ã‚­ãƒƒãƒãƒ³', val: 1, unit: 'weeks', advice: 'æºœã¾ã£ãŸæ±šã‚Œã‚’ã‚¹ãƒƒã‚­ãƒªè½ã¨ã—ã¾ã—ã‚‡ã†', order: 3 },
            { id: 104, name: 'æ›æ°—æ‰‡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼äº¤æ›', category: 'ã‚­ãƒƒãƒãƒ³', val: 2, unit: 'months', advice: 'ãƒ™ã‚¿ã¤ããŒæºœã¾ã‚‹å‰ã«', order: 4 },
            { id: 105, name: 'å†·è”µåº«ã®è„±è‡­å‰¤äº¤æ›', category: 'ã‚­ãƒƒãƒãƒ³', val: 6, unit: 'months', advice: 'é–‹ã‘ã‚‹ãŸã³çˆ½ã‚„ã‹ã«', order: 5 },
            { id: 201, name: 'ãŠé¢¨å‘‚ã®é˜²ã‚«ãƒ“ãã‚“ç…™å‰¤', category: 'æ°´å›ã‚Š', val: 2, unit: 'months', advice: 'ã‚«ãƒ“ã•ã‚“ã‚µãƒ¨ãƒŠãƒ©ğŸŒ¿', order: 6 },
            { id: 202, name: 'æ’æ°´æºãƒãƒƒãƒˆã®å®šæœŸäº¤æ›', category: 'æ°´å›ã‚Š', val: 1, unit: 'weeks', advice: 'ãƒŒãƒ¡ãƒªã‚’é˜²ã„ã§æ¸…æ½”ã«', order: 7 },
            { id: 203, name: 'æ´—æ¿¯æ§½ã‚¯ãƒªãƒ¼ãƒŠãƒ¼æƒé™¤', category: 'æ°´å›ã‚Š', val: 2, unit: 'months', advice: 'ãŠæ´‹æœã‚‚å–œã³ã¾ã™', order: 8 },
            { id: 204, name: 'ãŠé¢¨å‘‚ã®é€šæ°—å£ãƒ›ã‚³ãƒªå–ã‚Š', category: 'æ°´å›ã‚Š', val: 1, unit: 'months', advice: 'ç©ºæ°—ã®é€šã‚Šé“ã‚’ã‚­ãƒ¬ã‚¤ã«', order: 9 },
            { id: 205, name: 'ãƒˆã‚¤ãƒ¬ã®è„±è‡­ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'æ°´å›ã‚Š', val: 1, unit: 'months', advice: 'è¦‹ãˆãªã„å ´æ‰€ã»ã©å¤§åˆ‡ã«', order: 10 },
            { id: 301, name: 'ã‚¨ã‚¢ã‚³ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'ãƒªãƒ“ãƒ³ã‚°', val: 1, unit: 'months', advice: 'å…‰ç†±è²»ã®ç¯€ç´„ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã‚ˆ', order: 11 },
            { id: 302, name: 'ç©ºæ°—æ¸…æµ„æ©Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'ãƒªãƒ“ãƒ³ã‚°', val: 1, unit: 'months', advice: 'ãã‚Œã„ãªç©ºæ°—ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹', order: 12 },
            { id: 303, name: 'åŠ æ¹¿å™¨ãƒˆãƒ¬ãƒ¼ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'ãƒªãƒ“ãƒ³ã‚°', val: 2, unit: 'weeks', advice: 'æ°´å¢ã‚’é˜²ã„ã§æ½¤ã„ã‚­ãƒ¼ãƒ—', order: 13 },
            { id: 304, name: 'æƒé™¤æ©Ÿãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æƒé™¤', category: 'ãƒªãƒ“ãƒ³ã‚°', val: 1, unit: 'months', advice: 'å¸å¼•åŠ›ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†', order: 14 },
            { id: 305, name: 'ã‚«ãƒ¼ãƒ†ãƒ³ã®æ´—æ¿¯', category: 'ãƒªãƒ“ãƒ³ã‚°', val: 6, unit: 'months', advice: 'ãŠéƒ¨å±‹ãŒãƒ‘ãƒƒã¨æ˜ã‚‹ããªã‚Šã¾ã™', order: 15 },
            { id: 401, name: 'è»Šã®ã‚ªã‚¤ãƒ«äº¤æ›', category: 'å¤–å›ã‚Š', val: 6, unit: 'months', advice: 'æ„›è»Šã‚‚é•·ãå¤§åˆ‡ã«', order: 16 },
            { id: 402, name: 'è»Šã®æ´—è»Š', category: 'å¤–å›ã‚Š', val: 1, unit: 'months', advice: 'ãƒ”ã‚«ãƒ”ã‚«ã§ãƒ‰ãƒ©ã‚¤ãƒ–ã‚‚æ¥½ã—ã', order: 17 },
            { id: 403, name: 'è‡ªè»¢è»Šã®ç©ºæ°—å…¥ã‚Œ', category: 'å¤–å›ã‚Š', val: 1, unit: 'months', advice: 'ã‚¹ã‚¤ã‚¹ã‚¤é€²ã‚“ã§å¿«é©ã«', order: 18 },
            { id: 404, name: 'ç«ç½å ±çŸ¥å™¨ã®ç‚¹æ¤œ', category: 'é˜²ç½', val: 1, unit: 'years', advice: 'å®¶æ—ã®å®‰å…¨ã‚’é¡˜ã£ã¦', order: 19 },
            { id: 405, name: 'é˜²ç½ãƒªãƒ¥ãƒƒã‚¯ã®æœŸé™ãƒã‚§ãƒƒã‚¯', category: 'é˜²ç½', val: 1, unit: 'years', advice: 'å‚™ãˆã‚ã‚Œã°æ†‚ã„ãªã—ã§ã™ã­', order: 20 }
        ];

        let tasks = JSON.parse(localStorage.getItem('houseworkTasks')) || INITIAL_PRESETS.map(p => ({
            ...p, lastDone: null, nextDue: new Date().toISOString()
        }));

        // Migrating old tasks that only have intervalWeeks
        tasks = tasks.map(t => {
            if (t.intervalWeeks && !t.unit) {
                t.val = t.intervalWeeks;
                t.unit = 'weeks';
                delete t.intervalWeeks;
            }
            return t;
        });

        let currentTheme = localStorage.getItem('houseworkTheme') || 'soft';
        let currentView = 'today';

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            currentTheme = theme; localStorage.setItem('houseworkTheme', theme);
            document.querySelectorAll('.icon-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`theme-${theme}`).classList.add('active');
        }

        async function toggleNotifications() {
            alert('é€šçŸ¥æ©Ÿèƒ½ã¯ç¾åœ¨æº–å‚™ä¸­ã§ã™ã€‚ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã”åˆ©ç”¨ã„ãŸã ãã¨ã€ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§å¯¾å¿œäºˆå®šã§ã™â˜ºï¸');
        }

        function switchView(viewName) {
            currentView = viewName;
            document.getElementById('tab-today').classList.toggle('active', viewName === 'today');
            document.getElementById('tab-dashboard').classList.toggle('active', viewName === 'dashboard');
            document.getElementById('view-today').classList.toggle('active', viewName === 'today');
            document.getElementById('view-dashboard').classList.toggle('active', viewName === 'dashboard');
            document.getElementById('dynamic-subtitle').innerText = (viewName === 'today') ?
                "å¿˜ã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ã€ã‚ãªãŸã¯æ¯æ—¥é ‘å¼µã£ã¦ã„ã¾ã™ã€‚ âœ¨" : "ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å®¶äº‹ã®ä¸€è¦§ã§ã™ã€‚ã„ã¤ã§ã‚‚èª¿æ•´ã§ãã¾ã™ ğŸŒ¿";
            document.getElementById('fab-plus').style.display = (viewName === 'today') ? 'flex' : 'none';
            render();
        }

        function calculateNextDue(lastDoneStr, val, unit) {
            const base = lastDoneStr ? new Date(lastDoneStr) : new Date();
            const next = new Date(base);
            const num = parseInt(val);
            if (unit === 'days') next.setDate(next.getDate() + num);
            else if (unit === 'weeks') next.setDate(next.getDate() + (num * 7));
            else if (unit === 'months') next.setMonth(next.getMonth() + num);
            else if (unit === 'years') next.setFullYear(next.getFullYear() + num);
            return next.toISOString();
        }

        function render() {
            const listId = (currentView === 'today') ? 'today-list' : 'dashboard-list';
            const list = document.getElementById(listId); list.innerHTML = '';
            const filtered = (currentView === 'today') ? tasks.filter(t => new Date(t.nextDue) <= new Date()) : tasks;
            if (filtered.length === 0 && currentView === 'today') list.innerHTML = '<div style="text-align:center; padding:50px; opacity:0.6;">ä»Šã¯ã‚„ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚†ã£ãã‚Šä¼‘ã‚“ã§ãã ã•ã„ã­ ğŸµ</div>';
            else filtered.sort((a, b) => a.order - b.order).forEach(t => list.appendChild(createCard(t, currentView === 'today')));
            localStorage.setItem('houseworkTasks', JSON.stringify(tasks));
        }

        function formatIntervalText(val, unit) {
            const unitMap = { days: 'æ—¥', weeks: 'é€±é–“', months: 'ãƒ¶æœˆ', years: 'å¹´' };
            return `${val}${unitMap[unit]}ãŠã`;
        }

        function createCard(task, showActions) {
            const card = document.createElement('div'); card.className = 'task-card slide-up';
            const isDue = new Date(task.nextDue) <= new Date();
            const dateStr = new Date(task.nextDue).toLocaleDateString('ja-JP', { month: 'long', day: 'numeric' });
            const guideKey = Object.keys(STANDARD_GUIDES).find(k => task.name.includes(k));
            const adviceText = task.advice || "ã”å®¶åº­ã®ãƒšãƒ¼ã‚¹ã§å¤§ä¸ˆå¤«ã§ã™ã‚ˆâ˜ºï¸";
            const maxVal = task.unit === 'days' ? 31 : (task.unit === 'weeks' ? 52 : (task.unit === 'months' ? 24 : 10));

            card.innerHTML = `
                ${task.category ? `<span class="category-label">${task.category}</span>` : ''}
                <span class="task-name">${task.name}</span>
                <div class="task-meta">
                    æ¬¡å›ç›®å®‰: ${dateStr} 
                    <span class="status-badge ${isDue ? 'status-due' : 'status-future'}">${isDue ? 'ãã‚ãã‚ã‹ãªï¼Ÿ' : 'ã¾ã å…ˆã§ã™'}</span>
                </div>
                <div class="advice-box">${adviceText}</div>
                <div class="slider-section">
                    <div class="slider-label">
                        <span>å‘¨æœŸã‚’èª¿æ•´ ${guideKey ? `<span class="guide-text">æ¨™æº–: ${STANDARD_GUIDES[guideKey].text}</span>` : ''}</span>
                        <span class="slider-value" id="val-${task.id}">${formatIntervalText(task.val, task.unit)}</span>
                    </div>
                    <input type="range" min="1" max="${maxVal}" value="${task.val}" 
                        style="touch-action: none; cursor: grab;"
                        oninput="updateInterval(${task.id}, this.value)" 
                        onchange="render()"
                        ontouchstart="event.stopPropagation()" 
                        ontouchmove="event.stopPropagation(); event.preventDefault();" 
                        onmousedown="event.stopPropagation()">
                </div>
                ${showActions ? `<div class="btn-group">
                    <button class="btn-complete" onclick="completeTask(${task.id})">ã‚„ã£ãŸã‚ˆï¼</button>
                    <button class="btn-tomorrow" onclick="postponeTask(${task.id})">æ˜æ—¥ã‚„ã‚‹</button>
                </div>` : ''}`;
            return card;
        }

        function updateInterval(id, val) {
            const t = tasks.find(x => x.id === id);
            t.val = parseInt(val);
            t.nextDue = calculateNextDue(t.lastDone, t.val, t.unit);
            // Update only the label text immediately to avoid layout jumps
            const label = document.getElementById(`val-${id}`);
            if (label) label.innerText = formatIntervalText(t.val, t.unit);
            // State is saved in render() which is called on 'change'
        }

        function completeTask(id) {
            const t = tasks.find(x => x.id === id);
            t.lastDone = new Date().toISOString();
            t.nextDue = calculateNextDue(t.lastDone, t.val, t.unit);
            document.getElementById('praise-text').innerText = ["æœ€é«˜ã§ã™âœ¨", "æ•´ã„ã¾ã—ãŸğŸŒ¿", "ç´ æ•µã§ã™ï¼", "ãŠç–²ã‚Œæ§˜â˜ºï¸"][Math.floor(Math.random() * 4)];
            showModal('feedback-overlay'); render();
        }

        function postponeTask(id) {
            const t = tasks.find(x => x.id === id);
            const tmw = new Date(); tmw.setDate(tmw.getDate() + 1);
            t.nextDue = tmw.toISOString(); render();
        }

        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
            if (id === 'add-modal') {
                document.getElementById('new-task-name').oninput = e => {
                    const g = Object.keys(STANDARD_GUIDES).find(k => e.target.value.includes(k));
                    document.getElementById('add-guide').innerText = g ? `æ¨™æº–ç›®å®‰: ${STANDARD_GUIDES[g].text}` : '';
                };
            }
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function addTask() {
            const name = document.getElementById('new-task-name').value;
            const val = parseInt(document.getElementById('new-task-value').value);
            const unit = document.getElementById('new-task-unit').value;
            if (!name) return;
            const newTask = {
                id: Date.now(),
                name,
                val,
                unit,
                category: 'è‡ªåˆ†æµ',
                order: tasks.length + 1,
                lastDone: null,
                advice: 'ã”å®¶åº­ã®ãƒšãƒ¼ã‚¹ã§å¤§ä¸ˆå¤«ã§ã™ã‚ˆâ˜ºï¸'
            };
            newTask.nextDue = calculateNextDue(null, val, unit);
            tasks.push(newTask);
            closeModal('add-modal'); render();
        }

        function resetTasks() {
            if (confirm("å®¶äº‹ãƒªã‚¹ãƒˆã‚’åˆæœŸè¨­å®šï¼ˆ20é …ç›®ï¼‰ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\nâ€»ã”è‡ªèº«ã§è¿½åŠ ãƒ»å¤‰æ›´ã—ãŸå†…å®¹ã¯æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ã€‚")) {
                localStorage.removeItem('houseworkTasks');
                location.reload();
            }
        }

        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        setTheme(currentTheme); render();
    </script>
</body>

</html>